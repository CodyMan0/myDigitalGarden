# JWT


==JWT==(JSON Web Token)는 클라이언트(사용자)와 서버 간에 정보를 JSON 개체로 안전하게 전송하기 위한 개방형 표준(RFC 7519)입니다.
Q. [[Restful-API]]와 연관이 있나? 

==SAML== (Security Assertion Markup Language Token) 보다 크기가 작아 더 컴팩트하게 사용할 수 있습니다. ==JWT는 JSON 개체에 기본정보, 전달할 정보, 검증 정보==를 모두 담고 있습니다. 또한, JWT는 전자 서명이 되어있기 때문에 검증 과정을 거쳐 확인하고 신뢰할 수 있으며 Secret Key 또는 Public/Private Key Pair를 사용하여 서명할 수 있습니다.  

[[책과 연관]]
JWT는 일반적으로 ==Base64로 인코딩된 데이터==와 ==전자 서명==으로 구성되어 있습니다. JWT 역시 데이터를 암호활 할 수 있지만, JWT가 전자서명이 되어 있다는 점이 중요 합니다. 전자 서명된 JWT의 목적은 데이터를 숨기는 것이 아니라 ==데이터의 신뢰성==을 보장하는 것입니다. 그렇기 때문에 서명된 JWT와 함께 HTTPS를 사용하는 것이 좋습니다  
  

JWT을 이용한 인증 과정은 ==사용자 측에 사용자의 정보를 관리하는 ****토큰 기반 인증 메커니즘입니다==. 따라서 서버에서 세션 정보를 저장하기 위해 세션 스토리지 또는 데이터베이스에 완전히 의존할 필요가 없습니다. 또한, 서버의 확장성과 멀티 기기 및 도메인에서 활용에서도 이점을 가지고 있습니다.

관련 [[카카오톡 로그인 하는 기능 추가하는 과정]]
access token? 
-> 접근 권한이 있는 어떤 값. 
-> 로그인의 여부에 따라 접근이 가능한 my page!! 

HTTP 통신은 프론트와 백앤드가 통신하는 방법 (stateless)

프론트 단에서 로그인 유무를 저장하여야 백앤드로 API 요청을 할 때 받아올 수 있다. 

프론트 단에서 유무를 저장할때 Access token 로 관리

#### access token이 왜 필요? 중요!!!
-> 프론트와 백의 통신 방법인 http 는 stateless한 특징을 가지고 있기 때문에 API를 호출할 때 페이지의 (특징)에 따라 로그인 상태의 유무를 보내줘야하는데,  API 통신은 이전 로그인에 대한 정보가 없다. 프론트에서 로그인 여부를 가지고 있다가 백앤드에게 로그인 상태가 필요한 컴포넌트에서 API를 보낼때 알려주기위해서  그 값을 access token으로 통신할 수 있기에 필요하다.  access token이 필요한 것.


-> 한단계 들어가면 access token 안에 JWT가 있는 것. 



 



## 1-2. JWT 구조

JWT는 JSON Web Token의 약자로, access token을 만드는 방법 중 하나입니다. JWT는 토큰 자체에 유저의 권한을 위한 정보가 포함됩니다. `.`으로 구분된 이 장황한 문자열이 JWT의 예시입니다. JWT는 총 3가지 부분으로 구분됩니다. header는 JWT 토큰을 어떻게 해석해야 하는지를 적어놓은 부분입니다. payload는 JWT에 포함할 정보가 들어가는 부분입니다. signature는 JWT의 위변조를 파악하는 부분입니다.

(acces token은 생성은 백앤드 관리는 프론트 )

JWT는 토큰 자체에 정보를 담아서 주고받을 수 있는데, ==JWT==는 민감한 정보 교환을 위해 사용되기도 하고 현대 웹에서 가장 많이 쓰이는 예시는 ==인증&인가==를 위해서 사용합니다. 쉽게 이야기하면, 신분증처럼 신원이 확인된 사람인지 아닌지 확인용으로 JWT를 쓰는 건데, 로그인 후할 수 있는 모든 활동에 JWT를 제시하고 인증된 사용자인지 허가를 받는 경우입니다. 예를 들어 마이페이지에 접근하거나, 쿠폰을 받거나, 맘에 드는 제품에 찜을 하거나, 리뷰를 쓰거나 하는 활동입니다.  
  

그런데 만약 토큰을 주고받는 중간에 해커에게 탈취돼서 다른 정보로 변조되거나, 원래 정보인 것처럼 위조된다면 어떻게 토큰을 신뢰할 수 있을까요. 바로, signature로 위변조 내역을 검증하는 것으로 신뢰할 수 있는 토큰인지 파악할 수 있습니다. 유저가 발급받은 JWT를 서버에 담아 보내고, 서버는 유저에게 받은 JWT의 위변조 여부를 검증해 이상이 없다면 권한을 부여하고, 이상이 있다면 권한을 주지 않습니다.

![[스크린샷 2022-08-09 오후 9.14.22.png]]

## 2. JWT 발급 절차

---

JWT가 언제 필요한지는 알았습니다. 그럼, JWT는 언제, 어떻게, 어디서 발급받는지 살펴봅시다.

1.  클라이언트가 로그인하기 위해서 여러 인증 정보(userId, userPassword 등등)를 가지고 인증 요청을 합니다.
2.  인증이 완료되면**(언제)**, 인증서버**(어디서)**에서 암호화된 사용자의 식별 정보를 포함하고 있는 access token**(JWT)**을 발급합니다.
3.  발급한 token은 ==response의 Body에 담아 사용자에게 전달==됩니다.**(어떻게)**

하지만, 여러분도 아시다시피 HTTP 통신의 특징 중에 Stateless를 떠올려보면, 로그인 이후에 토큰을 받았다는 상태는 HTTP 통신 이후 남아있지 않고 1회 성으로 사라집니다. 그러면, 사용자는 로그인이 필요한 모든 활동을 할 때마다 토큰을 받아야 하는 불편한 상황이 벌어집니다. 생각해 보면, 우리가 필요한 건 token이 지 통신 그 자체가 아니기 때문에, 로그인할 때 발급받은 token을 어딘가에 저장해 놓는다면 매번 발급받지 않고도 필요할 때 꺼내 쓸 수 있게 됩니다. "프론트엔드는 저장할 수 있는 공간이 없는데요?”라고 한다면, 브라우저의 storage를 생각해 봅시다.


## 3. JWT 사용 방법

---

### 3-1. JWT 브라우저 storage 저장 방법

로그인 후 response의 body에 담긴 access token(JWT)을 브라우저의 저장소인 local storage, session storage, cookie에 저장할 수 있습니다.

-   local storage는 ==해당 도메인에 영구 저장==하고 싶을 때
-   session storage는 해당 도메인의 한 세션에만 저장하고 싶을 때. ==창을 닫으면 저장한 data==가 삭제됩니다.
-   cookie는 해당 ==도메인에 날짜를 설정하고 그때까지만 저장하고 싶을 때==

이렇게 각각의 용도에 따라 다르게 저장할 수 있습니다. 저장하는 방법은 간단합니다. 예를 들어 로그인 요청 후 local storage에 토큰을 저장하는 방법을 보면,

![[스크린샷 2022-08-09 오후 9.18.34.png]]

1.  로그인하려는 API 주소로
2.  POST 메서드 요청(request)을 보내는데
3.  headers에 `{'Content-Type': 'application/json'}` 를 담고
4.  body에 `{'id': 'kim','password': '1234'}`를 JSON으로 변환해서 요청합니다.
5.  첫 번째 응답에서 통신에 성공해 response.status가 200이면(혹은 다른 200번대의 코드면) JSON을 객체로 변환하거나,
6.  실패했을 경우 error를 던져
7.  catch로 error를 받아 console.log로 통신 실패 에러를 띄웁니다.
8.  통신에 성공하고, 두 번째 응답에서 반환된 object의 key 중에 message가 SUCCESS라면 localStorage에 key는 'token', value는 data.token의 형태로 저장하고 console.log로 메시지를 출력합니다.
9.  만약 id가 틀리다면 메시지를 alert 창으로 띄우고 함수를 종료합니다.

이런 통신 단계를 거쳐 브라우저의 local storage에 저장합니다.

### 3-2. 저장한 JWT 활용 방법

마이페이지에 접속하거나, 좋아요 기능을 누르거나, 상품을 주문하고 삭제하고, 로그인인지 로그아웃인지 UI를 동적으로 바꾸는 등 access token(JWT)을 받은 유저만 할 수 있는 기능들은 반드시 token으로 인증된 사용자라는 걸 서버에 알려야 합니다.  
  

그런데, localStorage에 token을 저장했기 때문에 이제부턴 token이 필요한 순간이면 언제든 꺼내서 쓸 수 있습니다. storage에서 ==저장된 데이터를 가져오는 메서드가 storage.getItem()==입니다.  
  

이전에 localStorage에 저장했던 JWT 토큰을 사용하려면, localStorage.getItem("token")으로 호출하면 됩니다. ==여기서 전달되는 인자는 토큰의 key 값을 string 타입으로 전달하면 됩니다.==

```jsx
// 브라우저 storage에서 JWT 가져오기 예시 
const token = localStorage.getItem('token');
```

### 4. Summary

---

-   JWT(JSON Web Token)는 토큰 자체에 정보를 넣어서 주고 받을 수 있는 구조 입니다.
-   JWT는 크게 headers,payload,signature로 나눌 수 있고, 정보의 위변조 여부를 signature로 확인가능합니다.
-   ==access token을 만드는 방법중 하나가 JWT==입니다.
-   로그인에 성공하면 서버에서 인증된 유저라고 신분증처럼 JWT를 발급합니다.
-   HTTP 통신의 stateless특성 때문에 JWT를 받은 내역을 기억하고 있지 못해서 어딘가 저장해서 써야합니다.
-   클라이언트는 browser storage를 사용 할 수 있고, local,session,cookie등 목적에 따라 저장 가능합니다.
-   ==local storage 저장을 예로들면 localStorage.setItem(), storage에서 꺼내오려면 localStorage.getItem()으로 활용 가능==합니다.




### 연결문서
- 
